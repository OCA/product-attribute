=====================
Product Order No Name
=====================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Production%2FStable-green.png
    :target: https://odoo-community.org/page/development-status
    :alt: Production/Stable
.. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: LGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fproduct--attribute-lightgray.png?logo=github
    :target: https://github.com/OCA/product-attribute/tree/12.0/product_order_noname
    :alt: OCA/product-attribute
.. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
    :target: https://translation.odoo-community.org/projects/product-attribute-12-0/product-attribute-12-0-product_order_noname
    :alt: Translate me on Weblate
.. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
    :target: https://runbot.odoo-community.org/runbot/135/12.0
    :alt: Try me on Runbot

|badge1| |badge2| |badge3| |badge4| |badge5| 

This module improves retrieving products when a language is installed and configured.
The default behaviour is to order products by name, which in this case would be slow
because Odoo will process the product's name to translate it.

Warning: This changes the way products are ordered
product are ordered "default_code, id"
instead of "default_code, translated(name), id"

Because Odoo needs the following query to get a translated(name)

.. code-block::

    SELECT "product_product".id
    FROM   "product_product"
    LEFT JOIN "product_template" AS "product_product__product_tmpl_id"
        ON ( "product_product"."product_tmpl_id" =
            "product_product__product_tmpl_id"."id" )
    LEFT JOIN (SELECT res_id,
                        value
                FROM   "ir_translation"
                WHERE  type = 'model'
                        AND name = 'product.template,name'
                        AND lang = 'es_MX'
                        AND value != '') AS
                "product_product__product_tmpl_id__name"
        ON ( "product_product__product_tmpl_id"."id" =
                        "product_product__product_tmpl_id__name"."res_id" )
    WHERE  ( "product_product"."active" = true )
    ORDER  BY "product_product"."default_code",
            Coalesce("product_product__product_tmpl_id__name"."value",
            "product_product__product_tmpl_id"."name"),
            "product_product"."id"
    LIMIT  10


Using a production database executing this query the result is:
 - Planning Time: 1.088 ms
 - Execution Time: 1027.282 ms
 - Total Time: 1028.37 ms

It is so slow.

Using the new order: "default_code, id" the following query is executed now:

.. code-block::

    SELECT "product_product".id
    FROM   "product_product"
    WHERE  ( "product_product"."active" = true )
    ORDER  BY "product_product"."default_code"
    LIMIT  10

The new result is:
 - Planning Time: 0.095 ms
 - Execution Time: 0.529 ms
 - Total Time: 0.624 ms

It is 1.65k times faster

It is because the field ``name`` has the parameter ``translate=True``

So, It will process the original value to translate it

Then, It will order by a column computed on-the-fly of other tables

default_code is a column indexed so the result is faster

Opening the ``/shop`` page could consume 7.5s instead of 1.2s without this module

Odoo is using the _order parameter even if you don't need it.
 - ``products.search(...).write(...)``
 - ``browse().*2many_product_ids.ids``


More info about this on:

  https://github.com/odoo/odoo/pull/61618

**Table of contents**

.. contents::
   :local:

Usage
=====

Just by installing the module you should see a performance increase when retrieving products, from the website shop
or the product's list view for example.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/product-attribute/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/OCA/product-attribute/issues/new?body=module:%20product_order_noname%0Aversion:%2012.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* Vauxoo

Contributors
~~~~~~~~~~~~

* Williams Estrada <williams@vauxoo.com> https://www.vauxoo.com/
* Moises Lopez <moylop260@vauxoo.com> https://www.vauxoo.com/

Other credits
~~~~~~~~~~~~~

This module was created and is maintained by:

* Vauxoo, S.A. de C.V.

.. image:: http://www.vauxoo.com/logo.png
   :alt: Vauxoo, S.A. de C.V.
   :target: http://www.vauxoo.com

Maintainers
~~~~~~~~~~~

This module is maintained by the OCA.

.. image:: https://odoo-community.org/logo.png
   :alt: Odoo Community Association
   :target: https://odoo-community.org

OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.

.. |maintainer-WR-96| image:: https://github.com/WR-96.png?size=40px
    :target: https://github.com/WR-96
    :alt: WR-96
.. |maintainer-moylop260| image:: https://github.com/moylop260.png?size=40px
    :target: https://github.com/moylop260
    :alt: moylop260
.. |maintainer-luisg123v| image:: https://github.com/luisg123v.png?size=40px
    :target: https://github.com/luisg123v
    :alt: luisg123v

Current `maintainers <https://odoo-community.org/page/maintainer-role>`__:

|maintainer-WR-96| |maintainer-moylop260| |maintainer-luisg123v| 

This module is part of the `OCA/product-attribute <https://github.com/OCA/product-attribute/tree/12.0/product_order_noname>`_ project on GitHub.

You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
